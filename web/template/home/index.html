<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="./vars.css" />
  <link rel="stylesheet" href="./style.css" />
  <title>主页</title>

  <style>
    a, button, input, select, h1, h2, h3, h4, h5, * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      border: none;
      text-decoration: none;
      background: none;
      -webkit-font-smoothing: antialiased;
    }

    menu, ol, ul {
      list-style-type: none;
      margin: 0;
      padding: 0;
    }

    .examples-waitlist {
      width: 100%;
      position: relative;
    }

    /* 大图自适应缩放 */
    @media (max-width: 1200px) {
      .examples-waitlist {
        transform: scale(0.95);
        transform-origin: top center;
      }
    }

    @media (max-width: 992px) {
      .examples-waitlist {
        transform: scale(0.9);
        transform-origin: top center;
      }
    }

    @media (max-width: 768px) {
      .examples-waitlist {
        transform: scale(0.85);
        transform-origin: top center;
      }

      .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
      }
    }

    @media (max-width: 576px) {
      .examples-waitlist {
        transform: scale(0.75);
        transform-origin: top center;
      }

      .title2 {
        font-size: 1.1em;
      }

      .subtitle {
        font-size: 0.9em;
      }
    }

    img {
      max-width: 100%;
      height: auto;
    }

    [style*="background-size: cover"] {
      background-position: center !important;
    }
  </style>
</head>
<body>
  <div class="examples-waitlist">
<div class="header">
  <div class="block" style="background: url(block0.png) center; background-size: cover; background-repeat: no-repeat;">
  </div>

  <div class="navigation-pill-list">
    <div class="navigation-pill">
      <div class="title">主页</div>
    </div>
  </div>

<!-- 用户头像（初始隐藏） -->
<div id="userAvatar" class="user-avatar" onclick="toggleLogoutModal()" style="display: none;">
  <img src="user-avatar.png" alt="用户头像" class="avatar-img" />
</div>

  <!-- 登录按钮 -->
  <div id="loginButton" class="button" onclick="showLogin()">
    <div class="div">登录</div>
  </div>
</div>

<!-- 退出登录模态框 -->
<div id="logoutModal" class="logout-modal" style="opacity: 0; pointer-events: none;">
  <div class="logout-content">
    <h3>确认退出登录？</h3>
    <div class="logout-buttons">
      <button class="cancel-button" onclick="toggleLogoutModal()">取消</button>
      <button class="confirm-button" onclick="logout()">退出</button>
    </div>
  </div>
</div>


	
<!-- 遮罩 + 登录框 -->
<div class="login-popup" id="loginPopup">
  <div class="login-content">
    <span class="close-btn" onclick="hideLogin()">×</span>
    <img src="block0.png" alt="Logo" class="logo">
    <input type="text" id="userid" placeholder="账号">
    <input type="password" id="password" placeholder="密码">
    <button id="loginButton" onclick="submitLogin()">登录</button>
  </div>
</div>

<!-- 消息框 -->
<div id="messageBox" class="message-box">
  <img id="messageImage" src="" style="width:24px;height:24px;">
  <span id="messageText">提示内容</span>
</div>


    <div class="hero-newsletter" style="background: url(hero-newsletter0.png) center; background-size: cover; background-repeat: no-repeat;">
      <div class="text-content-title">
        <div class="title2">打卡君</div>
        <div class="subtitle">一款功能多元、上手轻松的考勤利器</div>
      </div>
    </div>

    <!-- 新增卡片容器 -->
    <div class="card-grid" id="card-grid">
	 <div class="component-3" onclick="window.open('../mcp/mcp.html', '_self')">
        
        <div class="body3">
          <div class="text">
            <div class="ai">勤云慧管</div>
            <div class="div5">前所未有的智能管理助手</div>
          </div>
		  
          <div class="button-group"></div>
        </div>
		<img class="info4" src="robot_icon.png" />
      </div>
      <div class="component-1" onclick="window.open('../chart_ai/1.html', '_self')">
        
        <div class="body">
          <div class="text">
            <div class="ai">可视化界面</div>
            <div class="div2">更加清晰直观的统计</div>
          </div>
		  
          <div class="button-group"></div>
        </div>
		<img class="info" src="visualize-icon.png" />
      </div>

      
	  <div class="component-2" onclick="window.open('../excel/index.html', '_self')">
     
        <div class="body2">
          <div class="text">
            <div class="ai">数据库操作</div>
            <div class="div5">简洁高效的管理</div>
          </div>
		  
          <div class="button-group"></div>
        </div>
		<img class="info2" src="database-icon.png" />
      </div>
	  
    </div>

    <div class="footer">

<div class="footer-logo-container">
  <img class="logo2" src="logo.svg" />
  <div class="powered-by-2025">Powered By 打卡君 @2025</div>
</div>
    </div>
  </div>
  
  
  
  
  
  
<script>
  // 存储用户 ID
	let currentUserId = "";

  document.addEventListener('DOMContentLoaded', function () {
    const button = document.querySelector('.button3');
    const target = document.getElementById('card-grid');

    if (button && target) {
      button.addEventListener('click', function () {
        target.scrollIntoView({ behavior: 'smooth' });
      });
    }
  });
  
  
function showLogin() {
  const popup = document.getElementById("loginPopup");
  popup.style.display = "flex"; // 激活 CSS 动画
  // 重触发动画
  popup.classList.remove("login-popup"); // 触发 animation
  void popup.offsetWidth; // 强制重绘
  popup.classList.add("login-popup");
}


function hideLogin() {
  document.getElementById("loginPopup").style.display = "none";
}



function showMessage(success) {
  const box = document.getElementById("messageBox");
  const img = document.getElementById("messageImage");
  const text = document.getElementById("messageText");

  // 设置内容
  if (success) {
    img.src = "right.png";
    text.textContent = "登录成功！";
  } else {
    img.src = "wrong.png";
    text.textContent = "登录失败，请重试";
  }

  // 显示并开始动画
  box.style.display = "flex";
  box.classList.remove("hide");
  box.classList.add("show");

  // 2 秒后自动隐藏
  setTimeout(() => {
    box.classList.remove("show");
    box.classList.add("hide");

    // 淡出动画结束后隐藏元素
    setTimeout(() => {
      box.style.display = "none";
    }, 400);
  }, 2000);
}



async function submitLogin() {
  const id = document.getElementById("userid").value;
  const password = document.getElementById("password").value;

  const payload = { id, password };

  try {
    const response = await fetch("http://localhost:5013/login", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    });

    if (response.ok) {
      const result = await response.text();
      if (result === "True") {
        hideLogin(); // ✅ 隐藏登录浮窗
        showMessage(true);
		currentUserId = id; // 保存用户 ID
		loginSuccess()
      } else {
        showMessage(false);
      }
    } else {
      showMessage(false);
    }
  } catch (error) {
    console.error("请求失败：", error);
    showMessage(false);
  }
}

// 显示或隐藏退出登录模态框
function toggleLogoutModal() {
  const modal = document.getElementById('logoutModal');
  const isVisible = modal.style.opacity === '1';

  // 显示模态框时，确保有动画效果
  if (isVisible) {
    modal.style.opacity = '0';
    modal.style.pointerEvents = 'none';
  } else {
    modal.style.opacity = '1';
    modal.style.pointerEvents = 'auto';
  }
}


// 登录成功时调用此函数
function loginSuccess() {
  localStorage.setItem('user', currentUserId);


  document.getElementById('loginButton').style.display = 'none';
  document.getElementById('userAvatar').style.display = 'flex';
}

// 退出登录并刷新页面
function logout() {
  localStorage.removeItem('user');
  alert('已退出登录');
  location.reload();
}

// 页面加载时检查登录状态
window.onload = function () {
  const user = localStorage.getItem('user');
  if (user) {
    currentUserId = user; // ✅ 正确赋值
    loginSuccess();       // ✅ 调用无参数版本
  }
};

</script>
</body>
</html>


